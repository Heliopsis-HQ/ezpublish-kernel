<html>
    <head>
        <script
            type="text/javascript"
            src="../../../../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * This code example illustrates the issue with very generic exceptions.
 *
 * It tests the following scenario:
 * - create an article
 * - set the title to a string that is too long for the max length constraint set for the 'title' field
 * - catch and interpret the validation exception
 *
 * This is done in 3 ways:
 * 1. The current way, with a global exception upon contentCreate()
 * 2. Using exceptions thrown when setting the value on the struct
 * 3. Using a more specialized  exception thrown when contentCreate() is called
 */

use eZ\Publish\API\Repository\Repository;

/**
 * Assumed as injected
 * @var eZ\Publish\API\Repository\Repository
 */
$repository = new Repository;

$contentService = $repository-&gt;getContentService();
$locationService = $repository-&gt;getLocationService();
$contentTypeService = $repository-&gt;getContentTypeService();

$createStruct = $contentService-&gt;newContentCreateStruct(
    $contentTypeService-&gt;loadContentTypeByIdentifier( 'article' ),
    'eng-GB'
);

/**
 * Method 1
 *
 * Based on the current API, where validation is only done when using the service to create
 */
$createStruct-&gt;fields['title']['eng-GB'] = 'A title that is waaaaaaaaaaaaaaaaaaaaaaaaay too long for the title field';
$createStruct-&gt;fields['content']['eng-GB'] = '&lt;p&gt;What a &lt;strong&gt;wonderful&lt;/strong&gt; world !&lt;/p&gt;';
$createStruct-&gt;fields['show_comments'] = true;

try {
    $draft = $contentService-&gt;createContent(
        $createStruct,
        array(
            $locationService-&gt;newLocationCreateStruct( 123 )
        )
    );
    $publishedVersion = $contentService-&gt;publishDraft( $draft-&gt;versionInfo );
} catch( InvalidArgumentException $e ) {
    // This can mean that:
    // - no location has been set (4.x)
    // - the content's (and location's ?) remoteId already exists in the system
    // - one or more of the fields did not validate
}

/**
 * Method 2
 *
 * Possible improvement, where exceptions are actually thrown when assigning fields values
 */
try {
    $createStruct-&gt;fields['title']['eng-GB'] = 'This is my title';
} catch( FieldValidationException $e ) {
    // - We know the exception is about title, even though it will be repeated in the message
    // - The previous exception thrown earlier by the Type validator will
    //   provide us with details about what went wrong exactly
    echo &quot;An error occured when validating $e-&gt;identifier in $e-&gt;languageCode: &quot;  . $e-&gt;getMessage() . PHP_EOL;
}

$createStruct-&gt;fields['content']['eng-GB'] = '&lt;p&gt;What a &lt;strong&gt;wonderful&lt;/strong&gt; world !&lt;/p&gt;';
$createStruct-&gt;fields['show_comments'] = true;

try {
    $draft = $contentService-&gt;createContent(
        $createStruct,
        array(
            $locationService-&gt;newLocationCreateStruct( 123 )
        )
    );
    $publishedVersion = $contentService-&gt;publishDraft( $draft-&gt;versionInfo );
} catch( ContentValidationException $e ) {
    // Since fields have been validated earlier, all that's left is:
    // - no location has been set (4.x)
    // - the content's (and location's ?) remoteId already exists in the system
    // - one or more mandatory attributes haven't been given (we can't throw this one earlier, obviously)
} catch( InvalidArgumentException $e ) {
    // This one is only for border cases that don't fit in the more specified ones above
}

/**
 * Method 3
 *
 * An alternative, that doesn't use exceptions when setting values, but also provides the user with enough details.
 */
$createStruct-&gt;fields['title']['eng-GB'] = 'This is my title';
$createStruct-&gt;fields['content']['eng-GB'] = '&lt;p&gt;What a &lt;strong&gt;wonderful&lt;/strong&gt; world !&lt;/p&gt;';
$createStruct-&gt;fields['show_comments'] = true;

try {
    $draft = $contentService-&gt;createContent(
    $createStruct,
    array(
        $locationService-&gt;newLocationCreateStruct( 123 )
    )
    );
    $publishedVersion = $contentService-&gt;publishDraft( $draft-&gt;versionInfo );
} catch( ContentFieldValidationException $e ) {
    // Specific to field validation errors
    // Will let the user iterate over fields where errors were found, and analyze the exceptions attached to each
    foreach( $e-&gt;fieldsExceptions as $fieldException )
    {
        echo &quot;An error occured when validating $fieldException-&gt;identifier in $fieldException-&gt;languageCode: &quot;  . $fieldException-&gt;getMessage() . PHP_EOL;
    }
} catch( ContentValidationException $e ) {
    // Since fields have been validated earlier, all that's left is:
    // - no location has been set (4.x)
    // - the content's (and location's ?) remoteId already exists in the system
    // - one or more mandatory attributes haven't been given (we can't throw anything earlier)
} catch( InvalidArgumentException $e ) {
    // This can mean that:
    // - no location has been set (4.x)
    // - the content's (and location's ?) remoteId already exists in the system
    // - one or more of the fields did not validate
}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all()
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>