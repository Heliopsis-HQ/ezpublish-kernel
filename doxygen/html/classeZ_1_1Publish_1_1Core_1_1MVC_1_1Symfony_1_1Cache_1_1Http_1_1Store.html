<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ezp-next: eZ\Publish\Core\MVC\Symfony\Cache\Http\Store Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ezp-next
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for eZ\Publish\Core\MVC\Symfony\Cache\Http\Store:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store__inherit__graph.png" border="0" usemap="#eZ_0CPublish_0CCore_0CMVC_0CSymfony_0CCache_0CHttp_0CStore_inherit__map" alt="Inheritance graph"/></div>
<map name="eZ_0CPublish_0CCore_0CMVC_0CSymfony_0CCache_0CHttp_0CStore_inherit__map" id="eZ_0CPublish_0CCore_0CMVC_0CSymfony_0CCache_0CHttp_0CStore_inherit__map">
<area shape="rect" id="node5" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1LocationAwareStore.html" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\LocationAwareStore" alt="" coords="25,179,183,243"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for eZ\Publish\Core\MVC\Symfony\Cache\Http\Store:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store__coll__graph.png" border="0" usemap="#eZ_0CPublish_0CCore_0CMVC_0CSymfony_0CCache_0CHttp_0CStore_coll__map" alt="Collaboration graph"/></div>
<map name="eZ_0CPublish_0CCore_0CMVC_0CSymfony_0CCache_0CHttp_0CStore_coll__map" id="eZ_0CPublish_0CCore_0CMVC_0CSymfony_0CCache_0CHttp_0CStore_coll__map">
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a909cacc629cbe6b17854af549f95affa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a909cacc629cbe6b17854af549f95affa">__construct</a> ($root)</td></tr>
<tr class="memitem:a7cd2dfa4275c1538d2f79cdacf87b5d3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a7cd2dfa4275c1538d2f79cdacf87b5d3">cleanup</a> ()</td></tr>
<tr class="memitem:ab892374bade1be7d3c285c7227720d17"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#ab892374bade1be7d3c285c7227720d17">lock</a> (Request $request)</td></tr>
<tr class="memitem:a72a7abddf063bc69c3211378d44bc19b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a72a7abddf063bc69c3211378d44bc19b">unlock</a> (Request $request)</td></tr>
<tr class="memitem:ab7822e70305c543a4dd86f7d35448369"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#ab7822e70305c543a4dd86f7d35448369">lookup</a> (Request $request)</td></tr>
<tr class="memitem:ac0a36dbc7968ac9eef52e472c91b1755"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#ac0a36dbc7968ac9eef52e472c91b1755">write</a> (Request $request, Response $response)</td></tr>
<tr class="memitem:af79884d22749189e5c8bf98ec5c78057"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#af79884d22749189e5c8bf98ec5c78057">invalidate</a> (Request $request)</td></tr>
<tr class="memitem:ae02d35515856337457ad964f989b263e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#ae02d35515856337457ad964f989b263e">purge</a> ($url)</td></tr>
<tr class="memitem:a4d57d4f3d6f1c828814213fb12739c0a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a4d57d4f3d6f1c828814213fb12739c0a">getPath</a> ($key)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:af751439f8a3339e095e14047a2fc88d7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#af751439f8a3339e095e14047a2fc88d7">generateContentDigest</a> (Response $response)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:ac0a78836b6ee7cbe7c09f45f66c035f7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#ac0a78836b6ee7cbe7c09f45f66c035f7">$root</a></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html">Store</a> implements all the logic for storing cache metadata (Request and Response headers). This class is a enhanced version of <a class="el" href="namespaceeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony.html">Symfony</a> :</p>
<ul>
<li>Changes $root visibility from private to protected</li>
<li>Adds <a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#af751439f8a3339e095e14047a2fc88d7">generateContentDigest()</a> protected method allowing some control on content digest generation</li>
</ul>
<dl class="section author"><dt>Author</dt><dd>Fabien Potencier <a href="#" onclick="location.href='mai'+'lto:'+'fab'+'ie'+'n@s'+'ym'+'fon'+'y.'+'com'; return false;">fabie<span style="display: none;">.nosp@m.</span>n@sy<span style="display: none;">.nosp@m.</span>mfony<span style="display: none;">.nosp@m.</span>.com</a> </dd></dl>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00024">24</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>
</div><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a909cacc629cbe6b17854af549f95affa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::__construct </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$root</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Constructor.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$root</td><td>The path to the cache directory </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00035">35</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>

<p>References <a class="el" href="Store_8php_source.html#l00026">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store\$root</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        $this-&gt;root = <a class="code" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#ac0a78836b6ee7cbe7c09f45f66c035f7">$root</a>;</div>
<div class="line">        <span class="keywordflow">if</span> ( !is_dir( $this-&gt;root ) )</div>
<div class="line">        {</div>
<div class="line">            mkdir( $this-&gt;root, 0777, <span class="keyword">true</span> );</div>
<div class="line">        }</div>
<div class="line">        $this-&gt;keyCache = new \SplObjectStorage();</div>
<div class="line">        $this-&gt;locks = array();</div>
<div class="line">    }</div>
</div><!-- fragment -->
</div>
</div>
<h2>Member Function Documentation</h2>
<a class="anchor" id="a7cd2dfa4275c1538d2f79cdacf87b5d3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::cleanup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Cleanups storage. </p>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00049">49</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        <span class="comment">// unlock everything</span></div>
<div class="line">        <span class="keywordflow">foreach</span> ( $this-&gt;locks as $lock )</div>
<div class="line">        {</div>
<div class="line">            @unlink( $lock );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        $error = error_get_last();</div>
<div class="line">        <span class="keywordflow">if</span> ( 1 === $error[<span class="stringliteral">&#39;type&#39;</span>] &amp;&amp; <span class="keyword">false</span> === headers_sent() )</div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// send a 503</span></div>
<div class="line">            header( <span class="stringliteral">&#39;HTTP/1.0 503 Service Unavailable&#39;</span> );</div>
<div class="line">            header( <span class="stringliteral">&#39;Retry-After: 10&#39;</span> );</div>
<div class="line">            echo <span class="stringliteral">&#39;503 Service Unavailable&#39;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af751439f8a3339e095e14047a2fc88d7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::generateContentDigest </td>
          <td>(</td>
          <td class="paramtype">Response&#160;</td>
          <td class="paramname"><em>$response</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Returns content digest for $response</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Response</td><td class="paramname">$response</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string </dd></dl>

<p>Reimplemented in <a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1LocationAwareStore.html#a21a2a40dff185cdb28b00f8e6b85303b">eZ\Publish\Core\MVC\Symfony\Cache\Http\LocationAwareStore</a>.</p>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00212">212</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&#39;en&#39;</span> . sha1( $response-&gt;getContent() );</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p><div id="dynsection-2" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-2-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_af751439f8a3339e095e14047a2fc88d7_icgraph.png" border="0" usemap="#classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_af751439f8a3339e095e14047a2fc88d7_icgraph" alt=""/></div>
<map name="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_af751439f8a3339e095e14047a2fc88d7_icgraph" id="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_af751439f8a3339e095e14047a2fc88d7_icgraph">
<area shape="rect" id="node3" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#ac0a36dbc7968ac9eef52e472c91b1755" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\Store\\write" alt="" coords="271,5,428,69"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4d57d4f3d6f1c828814213fb12739c0a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::getPath </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$key</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reimplemented in <a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1LocationAwareStore.html#a037d07e50f9e334ade1f0b4fa64c939c">eZ\Publish\Core\MVC\Symfony\Cache\Http\LocationAwareStore</a>.</p>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00381">381</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;root . DIRECTORY_SEPARATOR . substr( $key, 0, 2 ) . DIRECTORY_SEPARATOR . substr( $key, 2, 2 ) . DIRECTORY_SEPARATOR . substr( $key, 4, 2 ) . DIRECTORY_SEPARATOR . substr( $key, 6 );</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p><div id="dynsection-3" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-3-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_a4d57d4f3d6f1c828814213fb12739c0a_icgraph.png" border="0" usemap="#classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_a4d57d4f3d6f1c828814213fb12739c0a_icgraph" alt=""/></div>
<map name="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_a4d57d4f3d6f1c828814213fb12739c0a_icgraph" id="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_a4d57d4f3d6f1c828814213fb12739c0a_icgraph">
<area shape="rect" id="node3" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#ab892374bade1be7d3c285c7227720d17" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\Store\\lock" alt="" coords="215,5,372,69"/><area shape="rect" id="node5" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a72a7abddf063bc69c3211378d44bc19b" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\Store\\unlock" alt="" coords="215,93,372,157"/><area shape="rect" id="node7" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#ab7822e70305c543a4dd86f7d35448369" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\Store\\lookup" alt="" coords="215,181,372,245"/><area shape="rect" id="node9" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#ae02d35515856337457ad964f989b263e" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\Store\\purge" alt="" coords="215,269,372,333"/><area shape="rect" id="node11" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1LocationAwareStore.html#abd60dd914e186f28e9d4a990c39ff653" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\LocationAwareStore\\purgeBy\lRequest" alt="" coords="421,261,632,342"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af79884d22749189e5c8bf98ec5c78057"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::invalidate </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Invalidates all cache entries that match the request.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>A Request instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00222">222</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        $modified = <span class="keyword">false</span>;</div>
<div class="line">        $key = $this-&gt;getCacheKey( $request );</div>
<div class="line"></div>
<div class="line">        $entries = array();</div>
<div class="line">        <span class="keywordflow">foreach</span> ( $this-&gt;getMetadata( $key ) as $entry )</div>
<div class="line">        {</div>
<div class="line">            $response = $this-&gt;restoreResponse( $entry[1] );</div>
<div class="line">            <span class="keywordflow">if</span> ( $response-&gt;isFresh() )</div>
<div class="line">            {</div>
<div class="line">                $response-&gt;expire();</div>
<div class="line">                $modified = <span class="keyword">true</span>;</div>
<div class="line">                $entries[] = array( $entry[0], $this-&gt;persistResponse( $response ) );</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">                $entries[] = $entry;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ( $modified )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> ( <span class="keyword">false</span> === $this-&gt;save( $key, serialize( $entries ) ) )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">throw</span> new \RuntimeException( <span class="stringliteral">&#39;Unable to store the metadata.&#39;</span> );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// As per the RFC, invalidate Location and Content-Location URLs if present</span></div>
<div class="line">        <span class="keywordflow">foreach</span> ( array( <span class="stringliteral">&#39;Location&#39;</span>, <span class="stringliteral">&#39;Content-Location&#39;</span> ) as $header )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> ( $uri = $request-&gt;headers-&gt;get( $header ) )</div>
<div class="line">            {</div>
<div class="line">                $subRequest = Request::create( $uri, <span class="stringliteral">&#39;get&#39;</span>, array(), array(), array(), $request-&gt;server-&gt;all() );</div>
<div class="line"></div>
<div class="line">                $this-&gt;<a class="code" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#af79884d22749189e5c8bf98ec5c78057">invalidate</a>( $subRequest );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab892374bade1be7d3c285c7227720d17"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::lock </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Locks the cache for a given Request.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>A Request instance</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Boolean|string true if the lock is acquired, the path to the current lock otherwise </dd></dl>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00074">74</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>

<p>References <a class="el" href="Store_8php_source.html#l00381">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store\getPath()</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> ( <span class="keyword">false</span> !== $lock = @fopen( $path = $this-&gt;<a class="code" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a4d57d4f3d6f1c828814213fb12739c0a">getPath</a>( $this-&gt;getCacheKey( $request ) . <span class="stringliteral">&#39;.lck&#39;</span> ), <span class="charliteral">&#39;x&#39;</span> ) )</div>
<div class="line">        {</div>
<div class="line">            fclose( $lock );</div>
<div class="line"></div>
<div class="line">            $this-&gt;locks[] = $path;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> $path;</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p><div id="dynsection-4" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-4-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ab892374bade1be7d3c285c7227720d17_cgraph.png" border="0" usemap="#classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ab892374bade1be7d3c285c7227720d17_cgraph" alt=""/></div>
<map name="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ab892374bade1be7d3c285c7227720d17_cgraph" id="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ab892374bade1be7d3c285c7227720d17_cgraph">
<area shape="rect" id="node3" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a4d57d4f3d6f1c828814213fb12739c0a" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\Store\\getPath" alt="" coords="215,5,372,69"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab7822e70305c543a4dd86f7d35448369"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::lookup </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Locates a cached Response for the Request provided.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>A Request instance</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Response|null A Response instance, or null if no cache entry was found </dd></dl>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00105">105</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>

<p>References <a class="el" href="Store_8php_source.html#l00381">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store\getPath()</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        $key = $this-&gt;getCacheKey( $request );</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ( !$entries = $this-&gt;getMetadata( $key ) )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> null;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// find a cached entry that matches the request.</span></div>
<div class="line">        $match = null;</div>
<div class="line">        <span class="keywordflow">foreach</span> ( $entries as $entry )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> ( $this-&gt;requestsMatch( isset( $entry[1][<span class="stringliteral">&#39;vary&#39;</span>][0] ) ? $entry[1][<span class="stringliteral">&#39;vary&#39;</span>][0] : <span class="stringliteral">&#39;&#39;</span>, $request-&gt;headers-&gt;all(), $entry[0] ) )</div>
<div class="line">            {</div>
<div class="line">                $match = $entry;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ( null === $match )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> null;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        list( $req, $headers ) = $match;</div>
<div class="line">        <span class="keywordflow">if</span> ( is_file( $body = $this-&gt;<a class="code" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a4d57d4f3d6f1c828814213fb12739c0a">getPath</a>( $headers[<span class="stringliteral">&#39;x-content-digest&#39;</span>][0] ) ) )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">return</span> $this-&gt;restoreResponse( $headers, $body );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// @todo the metaStore referenced an entity that doesn&#39;t exist in</span></div>
<div class="line">        <span class="comment">// the entityStore. We definitely want to return nil but we should</span></div>
<div class="line">        <span class="comment">// also purge the entry from the meta-store when this is detected.</span></div>
<div class="line">        <span class="keywordflow">return</span> null;</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p><div id="dynsection-5" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-5-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ab7822e70305c543a4dd86f7d35448369_cgraph.png" border="0" usemap="#classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ab7822e70305c543a4dd86f7d35448369_cgraph" alt=""/></div>
<map name="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ab7822e70305c543a4dd86f7d35448369_cgraph" id="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ab7822e70305c543a4dd86f7d35448369_cgraph">
<area shape="rect" id="node3" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a4d57d4f3d6f1c828814213fb12739c0a" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\Store\\getPath" alt="" coords="215,5,372,69"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae02d35515856337457ad964f989b263e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::purge </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$url</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Purges data for the given URL.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$url</td><td>A URL</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Boolean true if the URL exists and has been purged, false otherwise </dd></dl>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00320">320</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>

<p>References <a class="el" href="Store_8php_source.html#l00381">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store\getPath()</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> ( is_file( $path = $this-&gt;<a class="code" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a4d57d4f3d6f1c828814213fb12739c0a">getPath</a>( $this-&gt;getCacheKey( Request::create( $url ) ) ) ) )</div>
<div class="line">        {</div>
<div class="line">            unlink( $path );</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p><div id="dynsection-6" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-6-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ae02d35515856337457ad964f989b263e_cgraph.png" border="0" usemap="#classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ae02d35515856337457ad964f989b263e_cgraph" alt=""/></div>
<map name="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ae02d35515856337457ad964f989b263e_cgraph" id="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ae02d35515856337457ad964f989b263e_cgraph">
<area shape="rect" id="node3" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a4d57d4f3d6f1c828814213fb12739c0a" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\Store\\getPath" alt="" coords="215,5,372,69"/></map>
</div>
</p>

<p><div id="dynsection-7" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-7-trigger" src="closed.png" alt="+"/> Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ae02d35515856337457ad964f989b263e_icgraph.png" border="0" usemap="#classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ae02d35515856337457ad964f989b263e_icgraph" alt=""/></div>
<map name="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ae02d35515856337457ad964f989b263e_icgraph" id="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ae02d35515856337457ad964f989b263e_icgraph">
<area shape="rect" id="node3" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1LocationAwareStore.html#abd60dd914e186f28e9d4a990c39ff653" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\LocationAwareStore\\purgeBy\lRequest" alt="" coords="213,5,424,86"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a72a7abddf063bc69c3211378d44bc19b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::unlock </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Releases the lock for the given Request.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>A Request instance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00093">93</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>

<p>References <a class="el" href="Store_8php_source.html#l00381">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store\getPath()</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> @unlink( $this-&gt;<a class="code" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a4d57d4f3d6f1c828814213fb12739c0a">getPath</a>( $this-&gt;getCacheKey( $request ) . <span class="stringliteral">&#39;.lck&#39;</span> ) );</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p><div id="dynsection-8" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-8-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_a72a7abddf063bc69c3211378d44bc19b_cgraph.png" border="0" usemap="#classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_a72a7abddf063bc69c3211378d44bc19b_cgraph" alt=""/></div>
<map name="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_a72a7abddf063bc69c3211378d44bc19b_cgraph" id="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_a72a7abddf063bc69c3211378d44bc19b_cgraph">
<area shape="rect" id="node3" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#a4d57d4f3d6f1c828814213fb12739c0a" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\Store\\getPath" alt="" coords="215,5,372,69"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac0a36dbc7968ac9eef52e472c91b1755"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::write </td>
          <td>(</td>
          <td class="paramtype">Request&#160;</td>
          <td class="paramname"><em>$request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Response&#160;</td>
          <td class="paramname"><em>$response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes a cache entry to the store for the given Request and Response.</p>
<p>Existing entries are read and any that match the response are removed. This method calls write with the new list of cache entries.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">Request</td><td class="paramname">$request</td><td>A Request instance </td></tr>
    <tr><td class="paramtype">Response</td><td class="paramname">$response</td><td>A Response instance</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>string The key under which the response is stored </dd></dl>

<p>Definition at line <a class="el" href="Store_8php_source.html#l00153">153</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>

<p>References <a class="el" href="Store_8php_source.html#l00212">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store\generateContentDigest()</a>.</p>
<div class="fragment"><div class="line">    {</div>
<div class="line">        $key = $this-&gt;getCacheKey( $request );</div>
<div class="line">        $storedEnv = $this-&gt;persistRequest( $request );</div>
<div class="line"></div>
<div class="line">        <span class="comment">// write the response body to the entity store if this is the original response</span></div>
<div class="line">        <span class="keywordflow">if</span> ( !$response-&gt;headers-&gt;has( <span class="stringliteral">&#39;X-Content-Digest&#39;</span> ) )</div>
<div class="line">        {</div>
<div class="line">            $digest = $this-&gt;<a class="code" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#af751439f8a3339e095e14047a2fc88d7">generateContentDigest</a>( $response );</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ( <span class="keyword">false</span> === $this-&gt;save( $digest, $response-&gt;getContent() ) )</div>
<div class="line">            {</div>
<div class="line">                <span class="keywordflow">throw</span> new \RuntimeException( <span class="stringliteral">&#39;Unable to store the entity.&#39;</span> );</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            $response-&gt;headers-&gt;set( <span class="stringliteral">&#39;X-Content-Digest&#39;</span>, $digest );</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ( !$response-&gt;headers-&gt;has( <span class="stringliteral">&#39;Transfer-Encoding&#39;</span> ) )</div>
<div class="line">            {</div>
<div class="line">                $response-&gt;headers-&gt;set( <span class="stringliteral">&#39;Content-Length&#39;</span>, strlen( $response-&gt;getContent() ) );</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">// read existing cache entries, remove non-varying, and add this one to the list</span></div>
<div class="line">        $entries = array();</div>
<div class="line">        $vary = $response-&gt;headers-&gt;get( <span class="stringliteral">&#39;vary&#39;</span> );</div>
<div class="line">        <span class="keywordflow">foreach</span> ( $this-&gt;getMetadata( $key ) as $entry )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">if</span> ( !isset( $entry[1][<span class="stringliteral">&#39;vary&#39;</span>][0] ) )</div>
<div class="line">            {</div>
<div class="line">                $entry[1][<span class="stringliteral">&#39;vary&#39;</span>] = array( <span class="stringliteral">&#39;&#39;</span> );</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ( $vary != $entry[1][<span class="stringliteral">&#39;vary&#39;</span>][0] || !$this-&gt;requestsMatch( $vary, $entry[0], $storedEnv ) )</div>
<div class="line">            {</div>
<div class="line">                $entries[] = $entry;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        $headers = $this-&gt;persistResponse( $response );</div>
<div class="line">        unset( $headers[<span class="stringliteral">&#39;age&#39;</span>] );</div>
<div class="line"></div>
<div class="line">        array_unshift( $entries, array( $storedEnv, $headers ) );</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ( <span class="keyword">false</span> === $this-&gt;save( $key, serialize( $entries ) ) )</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">throw</span> new \RuntimeException( <span class="stringliteral">&#39;Unable to store the metadata.&#39;</span> );</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> $key;</div>
<div class="line">    }</div>
</div><!-- fragment -->
<p><div id="dynsection-9" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-9-trigger" src="closed.png" alt="+"/> Here is the call graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ac0a36dbc7968ac9eef52e472c91b1755_cgraph.png" border="0" usemap="#classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ac0a36dbc7968ac9eef52e472c91b1755_cgraph" alt=""/></div>
<map name="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ac0a36dbc7968ac9eef52e472c91b1755_cgraph" id="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store_ac0a36dbc7968ac9eef52e472c91b1755_cgraph">
<area shape="rect" id="node3" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html#af751439f8a3339e095e14047a2fc88d7" title="eZ\\Publish\\Core\\MVC\l\\Symfony\\Cache\\Http\l\\Store\\generateContentDigest" alt="" coords="215,5,428,69"/></map>
</div>
</p>

</div>
</div>
<h2>Member Data Documentation</h2>
<a class="anchor" id="ac0a78836b6ee7cbe7c09f45f66c035f7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">eZ\Publish\Core\MVC\Symfony\Cache\Http\Store::$root</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="Store_8php_source.html#l00026">26</a> of file <a class="el" href="Store_8php_source.html">Store.php</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/var/lib/jenkins/jobs/PAPI-doxygen-master/workspace/eZ/Publish/Core/MVC/Symfony/Cache/Http/<a class="el" href="Store_8php_source.html">Store.php</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceeZ.html">eZ</a></li><li class="navelem"><a class="el" href="namespaceeZ_1_1Publish.html">Publish</a></li><li class="navelem"><a class="el" href="namespaceeZ_1_1Publish_1_1Core.html">Core</a></li><li class="navelem"><a class="el" href="namespaceeZ_1_1Publish_1_1Core_1_1MVC.html">MVC</a></li><li class="navelem"><a class="el" href="namespaceeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony.html">Symfony</a></li><li class="navelem"><a class="el" href="namespaceeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache.html">Cache</a></li><li class="navelem"><a class="el" href="namespaceeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http.html">Http</a></li><li class="navelem"><a class="el" href="classeZ_1_1Publish_1_1Core_1_1MVC_1_1Symfony_1_1Cache_1_1Http_1_1Store.html">Store</a></li>
    <li class="footer">Generated on Sat Jan 5 2013 00:03:23 for ezp-next by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.2 </li>
  </ul>
</div>
</body>
</html>
